# AlmaU Syllabus Builder — документация для диплома

## 1. Назначение и цель
Проект решает проблему разрозненных учебных планов и силлабусов в Word/Excel. Цель — дать преподавателям единое пространство для создания курса, наполнения банка тем и сборки силлабуса на семестр с прозрачным workflow согласования и выпуском PDF.

## 2. Пользовательские роли и доступы
- Преподаватель: создает курсы, темы и силлабусы, отправляет на согласование.
- Руководитель программы: работает как преподаватель, использует общий банк материалов.
- Декан: проверяет и утверждает/отклоняет силлабусы на своем этапе.
- УМУ: финально утверждает силлабусы.
- Администратор: полный доступ к данным и процессам.

## 3. Основные функции
- Банк курсов и тем (многоязычные названия/описания, литература, контрольные вопросы).
- Конструктор силлабуса на семестр с настройкой недель, часов и контента.
- Загрузка готового PDF и работа в режиме точечных правок без обязательного заполнения тем.
- Генерация и хранение PDF по шаблону.
- Поиск и фильтры в списках силлабусов (курс, статус, год, автор).
- Общий доступ к курсам/силлабусам между преподавателями.
- Workflow согласования: черновик → декан → УМУ.
- Email-уведомления о смене статуса.
- AI-проверка структуры (не генерация, а анализ полноты).

## 4. Архитектура
Проект построен на Django (монолит) и разделен на приложения:
- accounts: пользователи, роли, подтверждение email.
- catalog: курсы, темы, литература, контрольные вопросы.
- syllabi: силлабусы, темы семестра, версия, PDF.
- workflow: статусы согласования и журнал изменений.
- ai_checker: структурный анализ силлабуса и помощник.
- core: healthz/diagnostics.

## 5. Структура данных (ключевые модели)
- User: пользователь с ролью, факультетом и кафедрой.
- Course: дисциплина (владелец, код, названия на 3 языках).
- Topic: тема курса с типом недели, часами, описанием, литературой, вопросами.
- Syllabus: силлабус семестра с параметрами, статусом и PDF.
- SyllabusTopic: связь силлабуса с темами, неделями и локальными полями.
- SyllabusRevision: версии изменений по силлабусу.
- SyllabusStatusLog: журнал переходов по статусам.
- AiCheckResult: результаты AI-проверки.

## 6. Бизнес-процесс (основной сценарий)
1) Преподаватель создает курс и наполняет банк тем.
2) Создает силлабус на семестр и выбирает темы/недели.
   Альтернатива: если есть готовый PDF, загружает его и правит только нужные разделы.
3) Проверяет структуру и отправляет на согласование декану.
4) Декан утверждает или отклоняет с комментарием.
5) После утверждения деканом силлабус отправляется в УМУ.
6) УМУ финально утверждает. Система фиксирует статус и историю.

## 7. Интеграции и сервисы
- PDF: WeasyPrint (нужны системные зависимости GTK/Pango).
- Email: SMTP или консольный backend для локального режима.
- AI: локальная модель (llama-cpp) или удаленный API (OpenAI-совместимый).

## 8. Настройка и запуск
1) Создать виртуальное окружение:
```
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
```
2) Настроить .env (см. раздел переменных окружения).
3) Применить миграции:
```
python manage.py migrate
```
4) Запустить сервер:
```
python manage.py runserver
```

## 9. Переменные окружения (ключевые)
- DJANGO_SECRET_KEY — секретный ключ Django.
- DJANGO_DEBUG — режим отладки (True/False).
- DJANGO_ALLOWED_HOSTS — список хостов через запятую.
- DATABASE_URL — строка подключения (если задана) или DB_*.
- DB_ENGINE, DB_NAME, DB_USER, DB_PASSWORD, DB_HOST, DB_PORT — параметры БД.
- EMAIL_HOST, EMAIL_PORT, EMAIL_HOST_USER, EMAIL_HOST_PASSWORD, EMAIL_USE_TLS.
- DEFAULT_FROM_EMAIL, SERVER_EMAIL.
- LLM_PROVIDER, LLM_API_KEY, LLM_API_URL, LLM_REMOTE_MODEL — удаленный AI.
- LLM_MODEL_PATH, LLM_CTX, LLM_THREADS, LLM_BATCH — локальный AI.

## 10. Структура проекта (каталоги)
- config/: настройки, urls, wsgi/asgi.
- templates/: HTML-шаблоны.
- static/: CSS и изображения.
- docs/: документация, ER-диаграммы.
- catalog/, syllabi/, workflow/, ai_checker/, accounts/.

## 11. Безопасность и надежность
- Ролевая модель доступа + журнал статусов.
- Журнал действий (изменения разделов, темы, загрузка PDF).
- Подтверждение email при регистрации.
- CSRF защита включена по умолчанию.
- Диагностика healthz/diagnostics для проверки сервиса.

## 12. Проверка качества
- Базовая проверка: `python manage.py check`.
- Дополнительно: тесты приложений (tests.py) по ключевым сценариям.

## 13. Что еще улучшить для продакшена
- Добавить автоматические тесты на роли, workflow и PDF.
- Вынести статические файлы в S3/MinIO и включить WhiteNoise.
- Добавить индексы на часто используемые поля (status, owner).
- Настроить CI/CD (миграции, линтер, тесты).
- Ограничить rate-limit для AI-эндпоинтов.
- Добавить аудит и логирование действий пользователей.
- Расширить шаблоны PDF под требования AlmaU.

## 14. Краткое резюме
AlmaU Syllabus Builder — это единая система для создания учебных силлабусов, согласования и выпусков PDF с поддержкой AI-проверки структуры. Проект покрывает полный цикл от курса и банка тем до финального утверждения и архивирования.
