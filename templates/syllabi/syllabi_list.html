{% extends "base.html" %}
{% block title %}–ú–æ–∏ —Å–∏–ª–ª–∞–±—É—Å—ã{% endblock %}

{% block content %}
<div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-6">
  <div>
    <h1 class="text-2xl font-bold text-slate-800">–ú–æ–∏ —Å–∏–ª–ª–∞–±—É—Å—ã</h1>
    <p class="text-slate-500 text-sm mt-1">–ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤—Å–µ –≤–∞—à–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å—ã.</p>
  </div>
  
{% if user.is_teacher_like %}
  <div class="flex gap-2">
    <a href="{% url 'create_constructor' %}" class="btn-primary shadow-md flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
      <i class="fas fa-edit"></i> –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
    </a>
    
    <a href="{% url 'upload_pdf' %}" class="btn-primary shadow-md flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
      <i class="fas fa-file-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å PDF
    </a>
  </div>
{% endif %}
</div>

<form method="get" class="card p-4 mb-6 bg-white shadow-sm border border-slate-200">
  <div class="grid gap-4 md:grid-cols-4 lg:grid-cols-5">
    <div class="md:col-span-2">
      <label class="block text-xs font-bold text-slate-500 uppercase mb-1">–ü–æ–∏—Å–∫</label>
      <input type="text" name="q" value="{{ filters.q }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞, –∫–æ–¥..." class="form-control w-full border-slate-300 rounded-md text-sm">
    </div>
    <div>
      <label class="block text-xs font-bold text-slate-500 uppercase mb-1">–°—Ç–∞—Ç—É—Å</label>
      <select name="status" class="form-select w-full border-slate-300 rounded-md text-sm">
        <option value="">–í—Å–µ</option>
        {% for value, label in status_options %}
          <option value="{{ value }}" {% if filters.status == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block text-xs font-bold text-slate-500 uppercase mb-1">–ì–æ–¥</label>
      <select name="year" class="form-select w-full border-slate-300 rounded-md text-sm">
        <option value="">–í—Å–µ</option>
        {% for item in year_options %}
          <option value="{{ item }}" {% if filters.year == item %}selected{% endif %}>{{ item }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="flex items-end gap-2">
      <button class="btn-secondary w-full text-sm" type="submit">–ù–∞–π—Ç–∏</button>
      <a href="{% url 'syllabi_list' %}" class="btn-secondary px-3 text-sm">‚úï</a>
    </div>
  </div>
</form>

<div class="card overflow-hidden bg-white shadow-sm border border-slate-200 rounded-lg">
  <table class="w-full text-left text-sm">
    <thead class="bg-slate-50 text-slate-500 font-semibold border-b">
      <tr>
        <th class="p-4">–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</th>
        <th class="p-4">–ü–µ—Ä–∏–æ–¥</th>
        <th class="p-4">–ê–≤—Ç–æ—Ä</th>
        <th class="p-4">–°—Ç–∞—Ç—É—Å</th>
        <th class="p-4 text-right">–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-slate-100">
    {% for syllabus in syllabi %}
      <tr class="hover:bg-slate-50 transition group">
        <td class="p-4">
          <div class="font-bold text-slate-800">{{ syllabus.course.code }}</div>
          <div class="text-xs text-slate-500">{{ syllabus.course.title_ru|truncatechars:40 }}</div>
        </td>
        <td class="p-4 text-slate-600">
          <div>{{ syllabus.semester }}</div>
          <div class="text-xs text-slate-400">{{ syllabus.academic_year }}</div>
        </td>
        <td class="p-4 text-slate-600">
            {{ syllabus.creator.get_full_name|default:syllabus.creator.username }}
        </td>
        <td class="p-4">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
            {% if syllabus.status == 'approved' %} bg-green-100 text-green-800
            {% elif syllabus.status == 'correction' %} bg-red-100 text-red-800
            {% elif syllabus.status == 'ai_check' %} bg-amber-100 text-amber-800 animate-pulse
            {% else %} bg-slate-100 text-slate-800 {% endif %}">
            {{ syllabus.get_status_display }}
          </span>
        </td>
        <td class="p-4 text-right flex justify-end gap-2">
          {% if syllabus.pdf_file %}
            <a href="{{ syllabus.pdf_file.url }}" target="_blank" class="text-slate-400 hover:text-blue-600 p-1" title="–°–∫–∞—á–∞—Ç—å PDF">
                üìÑ
            </a>
          {% endif %}
          <a href="{% url 'syllabus_detail' syllabus.pk %}" class="btn-secondary px-3 py-1 text-xs">
            –û—Ç–∫—Ä—ã—Ç—å
          </a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5" class="p-8 text-center text-slate-500">
          <div class="text-4xl mb-2">üìÇ</div>
          <p>–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç.</p>
          {% if user.is_teacher_like %}
            <a href="{% url 'syllabus_create' %}" class="text-blue-600 hover:underline mt-2 inline-block">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–π —Å–∏–ª–ª–∞–±—É—Å</a>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}